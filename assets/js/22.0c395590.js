(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{580:function(s,a,t){"use strict";t.r(a);var e=t(13),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"准备工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),t("p",[s._v("修改主机名(我只演示一台节点)")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主节点")]),s._v("\nhostnamectl set-hostname k8s-master\n\n")])])]),t("p",[s._v("修改hosts")]),s._v(" "),t("div",{staticClass:"language-bahs extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cat >/etc/hosts <<EOF\n192.168.56.101    k8s-master\nEOF\n")])])]),t("p",[s._v("转发IPv4并让iptables看到桥接流量")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/etc/modules-load.d/k8s.conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\noverlay\nbr_netfilter\nEOF")]),s._v("\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("modprobe overlay\nmodprobe br_netfilter\n")])])]),t("div",{staticClass:"language-bahs extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cat >/etc/sysctl.d/k8s.conf <<EOF\nnet.bridge.bridge-nf-call-iptables=1\nnet.bridge.bridge-nf-call-ip6tables=1\nnet.ipv4.ip_forward=1\nEOF\n")])])]),t("div",{staticClass:"language-bahs extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sysctl --system\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过运行以下指令确认 br_netfilter 和 overlay 模块被加载")]),s._v("\nlsmod "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("egrep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'overlay|br_netfilter'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过运行以下指令确认 net.bridge.bridge-nf-call-iptables、net.bridge.bridge-nf-call-ip6tables 系统变量在你的 sysctl 配置中被设置为 1")]),s._v("\nsysctl net.bridge.bridge-nf-call-iptables net.bridge.bridge-nf-call-ip6tables net.ipv4.ip_forward\n")])])]),t("p",[s._v("关闭swap分区或者禁用swap文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("swapoff -a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -ri "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/.*swap.*/#&/'")]),s._v(" /etc/fstab\n")])])]),t("p",[s._v("关闭selinux")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("setenforce "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^SELINUX=enforcing$/SELINUX=permissive/'")]),s._v(" /etc/selinux/config\n")])])]),t("h2",{attrs:{id:"安装k8s"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装k8s"}},[s._v("#")]),s._v(" 安装k8s")]),s._v(" "),t("p",[s._v("使用阿里云k8s源")]),s._v(" "),t("div",{staticClass:"language-bahs extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cat >/etc/yum.repos.d/kubernetes.repo <<EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n")])])]),t("p",[s._v("安装工具kubelet、kubeadm、kubectl")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("yum install -y kubelet-1.23.17 kubeadm-1.23.17 kubectl-1.23.17 --disableexcludes=kubernetes\n")])])]),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("Message "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 安装成功\n\n"),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("Installed")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  cri"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tools"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.26")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("x86_64               \n  kubeadm"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.23")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".17")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("x86_64               \n  kubectl"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.23")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".17")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("x86_64               \n  kubelet"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.23")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".17")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("x86_64               \n  kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cni"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("x86_64              \n\nComplete"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);